<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>ゆい姉さんの相談室</title>
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="/public/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/public/favicon.ico" type="image/x-icon">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yui-love.vercel.app/">
    <meta property="og:title" content="ゆい姉さんの恋愛相談室">
    <meta property="og:description" content="ゆい姉さんの恋愛相談室公式サイトです。">
    <meta property="og:image"
        content="https://yui-love.vercel.app/public/%E3%82%86%E3%81%84%E5%A7%89%E3%81%95%E3%82%93note%E3%82%B5%E3%83%A0%E3%83%8D%E3%82%A4%E3%83%AB.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ゆい姉さんの恋愛相談室">
    <meta name="twitter:description" content="ゆい姉さんの恋愛相談室公式サイトです。">
    <meta name="twitter:image"
        content="https://yui-love.vercel.app/public/%E3%82%86%E3%81%84%E5%A7%89%E3%81%95%E3%82%93note%E3%82%B5%E3%83%A0%E3%83%8D%E3%82%A4%E3%83%AB.jpg">
    <meta name="google-site-verification" content="2Xi8IPSGt7YW2_kOHqAzAfaxtgtYvNqiPSB_x8lhto4" />
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #fff9fb;
            font-family: sans-serif;
        }

        .site-wrapper {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .sidebar-left {
            padding: 20px;
            background: #fff;
            border-right: 1px solid #ffecf2;
            min-height: 100vh;
        }

        .yui-word {
            background: #fff0f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            border: 1px dashed #d63384;
        }

        .omikuji-btn {
            width: 100%;
            padding: 10px;
            background: #d63384;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        main {
            background: white;
            padding: 40px;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.02);
        }

        .search-box {
            text-align: right;
            margin-bottom: 20px;
        }

        .search-box input {
            padding: 8px;
            border: 1px solid #ffc0cb;
            border-radius: 5px;
            width: 200px;
        }

        header h1 {
            color: #d63384;
            border-bottom: 3px solid #ffc0cb;
            padding-bottom: 10px;
        }

        .sidebar-right {
            position: sticky;
            top: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
        }

        .yui-img {
            width: 100%;
            height: auto;
            display: block;
        }

        .bubble {
            background: white;
            border: 2px solid #ffc0cb;
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            color: #d63384;
            font-weight: bold;
            margin-bottom: -10px;
            z-index: 10;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .ad-container {
            margin-top: 20px;
        }

        .ad-space {
            margin-bottom: 0;
            text-align: center;
            line-height: 0;
        }

        .ad-space img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        /* モバイル用広告エリア */
        .mobile-ad-area {
            display: none;
        }

        @media (max-width: 1100px) {
            .site-wrapper {
                grid-template-columns: 1fr;
            }

            .sidebar-left,
            .sidebar-right {
                display: none;
            }

            main {
                padding: 20px;
                max-width: 100%;
                box-sizing: border-box;
            }

            .category-tabs {
                flex-wrap: wrap;
                gap: 10px;
            }

            /* モバイル時は広告を下部に表示 */
            .mobile-ad-area {
                display: block;
                margin: 40px auto;
                max-width: 100%;
                padding: 0 20px;
            }

            .mobile-ad-area .ad-space {
                margin-bottom: 0;
            }
        }
    </style>
</head>

<body>
    <div class="site-wrapper">
        <aside class="sidebar-left">
            <div class="yui-word"><strong>ゆい姉さん今日の一言</strong><br><span id="daily-msg">読み込み中...</span></div>
            <button class="omikuji-btn" onclick="drawOmikuji()">ゆい姉さんおみくじ</button>
            <div id="omikuji-result"
                style="margin-top:10px; font-size:0.85rem; color:#d63384; text-align:center; font-weight:bold;"></div>
            <div class="ad-container">
                <!-- 広告1 -->
                <div class="ad-space">
                    <a href="https://px.a8.net/svt/ejp?a8mat=3T8ZHQ+8NDQ5U+22QA+HZXM9" rel="nofollow">
                        <img border="0" height="250" alt=""
                            src="https://www21.a8.net/svt/bgt?aid=230526638523&wid=001&eno=01&mid=s00000009685003023000&mc=1"></a>
                    <img border="0" width="1" height="1" src="https://www11.a8.net/0.gif?a8mat=3T8ZHQ+8NDQ5U+22QA+HZXM9"
                        alt="">
                </div>
                <!-- 広告2 -->
                <div class="ad-space">
                    <a href="https://px.a8.net/svt/ejp?a8mat=3T909J+7N2A9E+9FQ+6DRLT" rel="nofollow">
                        <img border="0" height="250" alt=""
                            src="https://www26.a8.net/svt/bgt?aid=230527639462&wid=001&eno=01&mid=s00000001223001072000&mc=1"></a>
                    <img border="0" width="1" height="1" src="https://www13.a8.net/0.gif?a8mat=3T909J+7N2A9E+9FQ+6DRLT"
                        alt="">
                </div>
            </div>
        </aside>

        <main>
            <div class="search-box">
                <input type="text" id="search-input" placeholder="お悩みを検索..." onkeypress="handleSearch(event)">
            </div>
            <header>
                <h1>ゆい姉さんの相談室</h1>
            </header>

            <!-- カテゴリータブ -->
            <div class="category-tabs" id="category-tabs">
                <button class="cat-tab active" onclick="filterByCat('すべて', this)">すべて</button>
                <button class="cat-tab" onclick="filterByCat('片思い', this)">片思い</button>
                <button class="cat-tab" onclick="filterByCat('彼氏・彼女', this)">彼氏・彼女</button>
                <button class="cat-tab" onclick="filterByCat('結婚', this)">結婚</button>
                <button class="cat-tab" onclick="filterByCat('出会い', this)">出会い</button>
                <button class="cat-tab" onclick="filterByCat('復縁・別れ', this)">復縁・別れ</button>
                <button class="cat-tab" onclick="filterByCat('夜の悩み', this)">夜の悩み</button>
            </div>

            <div id="latest-posts-list" style="margin: 20px 0;">
                <p>お便りを探しているわ...</p>
            </div>

            <p style="text-align:center; margin-top:40px; font-size:0.9rem;">
                <a href="archive.html" style="color:#d63384; text-decoration:none; font-weight:bold;">→
                    過去のお悩みアーカイブへ</a>
        </main>

        <!-- モバイル用広告エリア（ページ下部） -->
        <div class="mobile-ad-area">
            <!-- 広告1 -->
            <div class="ad-space">
                <a href="https://px.a8.net/svt/ejp?a8mat=3T8ZHQ+8NDQ5U+22QA+HZXM9" rel="nofollow">
                    <img border="0" height="250" alt=""
                        src="https://www21.a8.net/svt/bgt?aid=230526638523&wid=001&eno=01&mid=s00000009685003023000&mc=1"></a>
                <img border="0" width="1" height="1" src="https://www11.a8.net/0.gif?a8mat=3T8ZHQ+8NDQ5U+22QA+HZXM9"
                    alt="">
            </div>
            <!-- 広告2 -->
            <div class="ad-space">
                <a href="https://px.a8.net/svt/ejp?a8mat=3T909J+7N2A9E+9FQ+6DRLT" rel="nofollow">
                    <img border="0" height="250" alt=""
                        src="https://www26.a8.net/svt/bgt?aid=230527639462&wid=001&eno=01&mid=s00000001223001072000&mc=1"></a>
                <img border="0" width="1" height="1" src="https://www13.a8.net/0.gif?a8mat=3T909J+7N2A9E+9FQ+6DRLT"
                    alt="">
            </div>
        </div>

        <aside class="sidebar-right">
            <a href="profile.html" class="bubble">ゆい姉さんのプロフィール</a>
            <img src="yui.png" alt="ゆい姉さん" class="yui-img">
        </aside>
    </div>

    <!-- モバイル用フローティングボタン -->
    <a href="profile.html" class="mobile-profile-btn">
        <img src="yuichibi.png" alt="プロフィールへ">
    </a>

    <script src="data/questions.js"></script>
    <script>
        // 検索処理
        function handleSearch(e) {
            if (e.key === 'Enter') {
                const query = document.getElementById('search-input').value;
                window.location.href = `archive.html?q=${encodeURIComponent(query)}`;
            }
        }

        const words = ["自分を大切にね。", "明日はきっといい日になるわ。", "あなたの味方はここにいるわ。"];
        document.getElementById('daily-msg').innerText = words[Math.floor(Math.random() * words.length)];

        function drawOmikuji() {
            const res = ["大吉：最高の出会いがあるかも！", "中吉：自分磨きが吉。", "吉：幸せが見つかる予感。"];
            document.getElementById('omikuji-result').innerText = res[Math.floor(Math.random() * res.length)];
        }

        let allPosts = [];
        const mapping = {
            '片思い': ['片思い', '初デート', '告白'],
            '彼氏・彼女': ['付き合って3ヶ月', '付き合って1年', '不信感', '信頼関係', '嫉妬', '浮気'],
            '結婚': ['結婚', '結婚前', '義実家', '義理'],
            '出会い': ['マッチングアプリ', '出会い', '合コン'],
            '復縁・別れ': ['別れ', '別れた後', '元彼', '復縁'],
            '夜の悩み': ['夜の', 'セフレ', '性生活', '都合のいい関係']
        };

        function getCategory(post) {
            const content = post.title + post.description;
            for (const [cat, keywords] of Object.entries(mapping)) {
                if (keywords.some(k => content.includes(k))) return cat;
            }
            return 'その他';
        }

        function filterByCat(cat, btn) {
            // タブの活性化
            document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');

            renderPosts(cat);
        }

        function renderPosts(categoryFilter = 'すべて') {
            const container = document.getElementById('latest-posts-list');

            // 公開済みかつフィルターに合うものを抽出
            const now = new Date();
            const todayStr = now.getFullYear() + '.' + String(now.getMonth() + 1).padStart(2, '0') + '.' + String(now.getDate()).padStart(2, '0');

            let filtered = allPosts.filter(post => post.date <= todayStr);

            if (categoryFilter !== 'すべて') {
                filtered = filtered.filter(post => getCategory(post) === categoryFilter);
            }

            // 最新6件に制限
            const displayPosts = filtered.slice(0, 6);

            if (displayPosts.length > 0) {
                container.innerHTML = displayPosts.map(post => `
                    <div class="post-item" style="margin-bottom: 50px; border-bottom: 1px dashed #ffecf2; padding-bottom: 20px;">
                        <p style="color:#999; font-size:0.8rem;">${post.date} 更新</p>
                        <h2 style="margin: 10px 0;"><a href="${post.url}" style="text-decoration:none; color:#333;">${post.title}</a></h2>
                        <p style="color:#666; line-height:1.6; font-size:0.95rem;">${post.description}</p>
                        <a href="${post.url}" style="color:#d63384; font-weight:bold; text-decoration:none;">お返事を読む ➔</a>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<p>該当するお便りはまだ届いていないみたい。待っていてね。</p>';
            }
        }

        // 記事読み込み (questions.jsから取得)
        if (typeof questionsData !== 'undefined') {
            allPosts = questionsData;
            renderPosts();
        } else {
            document.getElementById('latest-posts-list').innerHTML = '<p>読み込みに失敗しちゃった。リロードしてみてね。</p>';
        }
    </script>
</body>

</html>